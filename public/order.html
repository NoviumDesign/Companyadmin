<html>
<head>
	<title>test form</title>
	<style type="text/css">
		form {
			position: relative;
			width: 500px;
			margin: 100px auto 0 auto;
			box-shadow: 0 0 3px #000;
		}
		form fieldset {
			padding: 10px 5px;
			border: none;
			border-bottom: 1px solid rgb(236, 236, 236);
		}
		form fieldset > label {
			font-size: 20px;
			margin: 10px 0;
			display: block;
		}
		form fieldset section > label {
			font-size: 16px;
			margin-top: 7px;
			display: block;
		}
		form fieldset input {
			width: 300px;
		}
	</style>
</head>
<body>

	<form id="companyadmin" method="post" action="/request/post">
		<fieldset class="products">
			<label>Products</label>
		</fieldset>

		<fieldset class="customFields">
			<label>customFields</label>
		</fieldset>

		<fieldset>
			<label>Delivery</label>

			<section>
				<label>Delivery</label>
				<div>
					<input type="radio" name="order[delivery]" value="none">none
					<input type="radio" name="order[delivery]" value="requested">requested
				</div>
			</section>

			<section>
				<label>Delivery adress</label>
				<div>
					<input type="text" name="order[deliveryAdress]">
				</div>
			</section>

			<section>
				<label>Delivery date</label>
				<div>
					<input type="date" name="order[deliveryDate]">
				</div>
			</section>

			<section>
				<label>Delivery notes</label>
				<div>
					<textarea name="order[deliveryNotes]"></textarea>
				</div>
			</section>

		</fieldset>




		<fieldset>
			<label>Customer</label>

			<hr>
			<section>
				<label>Allready a user?</label>
				<p>
					Write the secret code you submited at your first order to skip this step
				</p>
				<div>
					<input class="try" type="text" name="customer[try]">
					<span class="tryCustomer"></span>
				</div>
			</section>
			<hr>

			<div class="test">
				<section>
					<label>Name</label>
					<div>
						<input type="text" name="customer[name]">
					</div>
				</section>

				<section>
					<label>Type</label>
					<div>
						<input type="radio" name="customer[type]" value="private">Private
						<input type="radio" name="customer[type]" value="company">Company
					</div>
				</section>

				<section>
					<label>Phone</label>
					<div>
						<input type="text" name="customer[phone]">
					</div>
				</section>

				<section>
					<label>mail</label>
					<div>
						<input type="mail" name="customer[mail]">
					</div>
				</section>

				<section>
					<label>Invoice adress *</label>
					<div>
						<input type="mail" name="customer[invoiceAdress]">
					</div>
				</section>
				
				<section>
					<label>Box *</label>
					<div>
						<input type="mail" name="customer[box]">
					</div>
				</section>

				<section>
					<label>Zip code</label>
					<div>
						<input type="mail" name="customer[zipCode]">
					</div>
				</section>
				
				<section>
					<label>City</label>
					<div>
						<input type="mail" name="customer[city]">
					</div>
				</section>

				<section>
					<label>Country</label>
					<div>
						<input type="mail" name="customer[country]">
					</div>
				</section>

				<section>
					<label>Customer notes</label>
					<div>
						<textarea name="customer[notes]"></textarea>
					</div>
				</section>

				<section>
					<label>Customer secret</label>
					<p>
						Write a secret code/mail/personal stuff so you will be able to skip this step next time you order!
					</p>
					<div>
						<input type="text" name="customer[secret]">
					</div>
				</section>
			</div>
		</fieldset>


		<fieldset>
			<input type="submit" value="submit">
		</fieldset>
	</form>




	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
	
		var url, token, getFormData, getToken, company, business, buildForm, formId;
		url = '';
		company = 'dfg7586ghf';
		business = '43g5345hj3';
		formId = '#companyadmin';

		getToken = function() {
			$.getJSON(
				url + '/request/token',
				function(response) {
					token = response.token;
					

					getFormData();
			});
		}

		getFormData = function() {
			$.getJSON(
				url + '/request/data/' + company + '/' + business + '/' + token,
				function(response) {
					token = response.token;
					


					buildForm(response.data)

			});
		}

		buildForm = function(data) {
			var products = '';
			for(var i = 0; i < data.products.length; i++) {
				products += 
					'<section>' + 
						'<label>' + data.products[i].product + '</label>' + 
						'<div>' +
							'<input type="number" name="products[' + data.products[i].product_secret + ']" value="">' +
							'<span>' + data.products[i].price + ' :- per ' + data.products[i].unit + '</span>' +
						'</div>' +
					'</section>';
			};

			var customFields = '';
			var i = 0;
			for(var j in data.customFields) {
				if(data.customFields[j]) {
				customFields += 
					'<section>' + 
						'<label>' + data.customFields[j] + '</label>' + 
						'<div>' +
							'<input type="text" name="customFields[' + i++ + ']" value="">' +
						'</div>' +
					'</section>';
				}
			};

			$(formId + ' .products').append(products);
			$(formId + ' .customFields').append(customFields);
		}

		var running = false;
		$(formId + ' .try').keyup(function() {
			var value = $(formId + ' .try').val();

			if(value.length > 4 && running == false) {
				running = true;
				$.post(
					url + '/request/customer/' + company + '/' + business + '/' + token,
		        	{'try' : value},
		        	function(response){
		        		running = false;

		        		token = response.token;
						
						if(response.customer) {
							$(formId + ' .tryCustomer').html(response.customer.name);
						} else {
							$(formId + ' .tryCustomer').html('');
						}

			    }, 'json');
			}
		});


		$(formId).submit(function(event) {
			event.preventDefault();

	        $.post(url + '/request/post/' + company + '/' + business + '/' + token,
	        	$(this).serialize(),
	        	function(response){
	        		token = response.token;

		            console.log(response);                     
		        });
	    	});

		$(document).ready(function() {
			getToken();
		});

	</script>
</body>
</html>

